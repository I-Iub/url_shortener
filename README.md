## Описание задания

Реализовать `http`-сервис, который обрабатывает поступающие запросы. Сервер 
стартует по адресу `http://127.0.0.1:8080` (значение по умолчанию, можно 
изменять).

<details>
<summary> Список возможных эндпоинтов (можно изменять) </summary>

1. Получить сокращённый вариант переданного URL.

```python
POST /
```

Метод принимает в теле запроса строку URL для сокращения и возвращает ответ с 
кодом `201`.

2. Вернуть оригинальный URL.

```python
GET /<shorten-url-id>
```

Метод принимает в качестве параметра идентификатор сокращённого URL и 
возвращает ответ с кодом `307` и оригинальным URL.

3. Вернуть статус использования URL.

```python
GET /<shorten-url-id>/status?[full-info]&[max-result=10]&[offset=0]
```

Метод принимает в качестве параметра идентификатор сокращённого URL и 
возвращает информацию о количестве переходов, совершенных по ссылке.

В ответе может содержаться как общее количество совершенных переходов, так и 
дополнительная детализированная информация о каждом переходе (наличие 
**query**-параметра **full-info** и параметров пагинации):
- дата и время перехода/использования ссылки;
- информация о клиенте, выполнившем запрос;

</details>


## Дополнительные требования:

- Реализуйте возможность «удаления» сохранённого URL. Запись должна остаться, 
но помечаться как удалённая. При попытке получения полного URL возвращать 
ответ с кодом `410 Gone`.
- Реализуйте middlware, блокирующий доступ к сервису из запрещённых подсетей 
(black list).
- Реализуйте возможность передавать ссылки пачками (batch upload).

<details>
<summary> Описание изменений </summary>

- Метод `POST /shorten` принимает в теле запроса список URL в формате:

```python
[
    {
        "original-url": "<URL-for-shorten>"
    },
    ...
]
```
... и возвращает данные в следующем формате:

```python
[
    {
        "short-id": "<shoten-id>",
        "short-url": "http://...",
    },
    ...
]
```
</details>

---
## Запуск проекта

Клонируйте проект 
```
git clone https://github.com/I-Iub/async-python-sprint-4.git
```

Перейдите в папку с проектом, создайте виртуальное окружение и активируйте его. python 3.8, ubuntu:
```
python3 -m venv venv
. venv/bin/activate
```
Установите зависимости
```
pip install --upgrade pip
pip install -r requirements.txt
```
Создайте базу данных. Например, можно создать её в docker-контейнере так:
```
docker run \
  --rm   \
  --name postgres-fastapi \
  -p 5432:5432 \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=urls \
  -d postgres:14.5
```
В корневой директории проекта создайте файл с переменными окружения `.env` (см. пример -- `.env.example`). Укажите в нём переменную `DSN` с параметрами, соответствующими созданной базе данных.

Выполните миграции:
```
alembic upgrade head
```
Для запуска в корневой директории проекта выполните:
```
PYTHONPATH=. python3 -m src.main
```

## Запуск тестов

Создайте тестовую базу данных. Например, можно создать её в docker-контейнере:
```
docker run \
  --rm   \
  --name postgres-fastapi-tests \
  -p 65432:5432 \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=urls \
  -d postgres:14.5
```
Если вы используете базу данных с другими параметрами, то исправьте соответствующим образом переменную `DSN` в файле `pytest.ini`, а также `DSN_TEST` в файле `.env`.

Запустите тесты:
```
PYTHONPATH=. pytest -v
```
